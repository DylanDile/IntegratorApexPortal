<script>
export default {
  data(){
    return{
      rId: '',
      model: {
        worksheetsCreated: null
      },
      workSheets: [],
      selectedSheets: []
    }
  } ,
  methods: {
    async regenerate(){
      if(this.selectedSheets.length === 0){
        return window.toasters.error('Please select at least one sheet to regenerate')
      }

      console.log(this.selectedSheets)
      // await window.axios.post(`/generated_returns/regenerate`, {
      //   id: this.rId,
      //   sheets: this.selectedSheets
      // }).then((response) => {
      //   this.model = response.data.body.model;
      // })
    },
    async init() {
      await window.axios.get(`/api/generated_returns/${this.rId}`).then((response) => {
        this.model = response.data.body.model;
        if(this.model.worksheetsCreated){
          let jsonString = this.model.worksheetsCreated;
          this.workSheets = JSON.parse(`[${jsonString.slice(1, -1)}]`);
        }
      })
    }
  },
  mounted() {
    this.rId = this.$route.params.id;
    this.init();
  }
}
</script>

<template>
 <div>
   <div class="mb-4 d-flex flex-row justify-content-between">
     <div>
       <h3 class="az-dashboard-title">Generated Returns / Details : {{ rId }}</h3>
       <p class="az-dashboard-text">
         View Generated Returns Details :
         <span class="font-weight-bold">
           {{ model.yearYYYY }} <span> {{ model.monthMM}}</span>
         </span>
       </p>
     </div>
     <div class="float-right row">
        <button class="btn btn-sm btn-outline-primary">
          <i class="fas fa-download"></i> Download
        </button>
        <button v-on:click="regenerate" class="btn btn-sm btn-outline-primary ml-2">
          <i class="fas fa-square"></i> Regenerate
        </button>
     </div>
   </div>
  <div class="row">
    <div class="card card-dashboard-pageviews col-sm-8">
      <div class="card-header d-flex flex-row justify-content-between">
        <h3 class="card-title">Detials</h3>
        <button class="float-right badge badge-primary" v-if="model.processed === 'Processed'">
          {{ model.processed}}
        </button>
        <button v-else class="badge badge-danger">
          {{ model.processed }}
        </button>
      </div><!-- card-header -->
      <div class="card-body">
        <div class="az-list-item">
          <div>
            <h6>Submission Pack</h6>
            <span>{{ model.submissionPack }}</span>
          </div>
          <div>
            <h6 class="tx-primary">
              {{ model.reportingDate }}
            </h6>
          </div>
        </div>
        <hr>
        <div class="d-flex flex-column">
          <div>
            <h6> <i class="fas fa-university tx-primary mr-3"></i>
              Institution Name</h6>
          </div>
          <div>
           <span class="tx-primary">
             {{ model.nameOfInstitution }}
           </span>
          </div>
        </div>
        <hr>
        <div class="az-list-item">
          <div>
            <h6>File Name</h6>
            <span class="tx-primary">
              <i class="fas fa-file-excel tx-primary mr-3 mt-2"></i>
              {{  model.returnFileName }}
           </span>
          </div>
          <div>
            <h6 class="tx-primary">
              <a>
                <i class="fas fa-download"></i>
              </a>
            </h6>
          </div>
        </div>
        <hr>
        <div class="d-flex flex-column">
          <div>
            <h6 class="font-weight-bold">
              <i class="fas fa-file-excel tx-primary mr-2 mt-2"></i>
              Work Sheets Generated
            </h6>
          </div>
          <div>
           <span>
             {{  model.worksheetsCreated }}
           </span>
          </div>
        </div>
        <hr>
        <div class="d-flex flex-column">
          <div>
            <h6 class="font-weight-bold">
              <i class="fas fa-calendar-alt tx-primary mr-2 mt-2"></i>
              File Size
            </h6>
          </div>
          <div>
           <span>
             {{ model.fileSize }} KB
           </span>
          </div>
        </div>

        <hr>

        <div class="d-flex flex-column">
          <div>
            <h6 class="font-weight-bold">
              <i class="fas fa-calendar-alt tx-primary mr-2 mt-2"></i>
              Generated By
            </h6>
          </div>
          <div>
           <span>
             {{ model.generatedBy }}
           </span>
          </div>
        </div>
      </div>
    </div>
    <div class="card card-dashboard-pageviews col-sm-4">
      <h3 class="card-title"> Check Sheets to regenerate </h3>
      <hr>
      <div>
        <form action="">
          <div v-for="sheet in workSheets" class="mb-3">
            <div class="col-lg-12" >
              <label class="ckbox">
                <input type="checkbox" :id="sheet" :value="sheet" v-model="selectedSheets"><span>{{ sheet }}</span>
              </label>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
 </div>
</template>